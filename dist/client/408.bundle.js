"use strict";(self.webpackChunkpoc_rubens_threejs_webgpu_renderer=self.webpackChunkpoc_rubens_threejs_webgpu_renderer||[]).push([[408],{739:(t,n,e)=>{e.d(n,{g:()=>o});class o{constructor(){this.boundingData=new Float32Array(6)}}},62:(t,n,e)=>{e.d(n,{d:()=>l,l:()=>u});var o=e(25),s=e(289);let r,i,a,c;const d=Math.pow(2,32);function l(t){return"count"in t?1:1+l(t.left)+l(t.right)}function u(t,n,e){return r=new Float32Array(e),i=new Uint32Array(e),a=new Uint16Array(e),c=new Uint8Array(e),f(t,n)}function f(t,n){const e=t/4,l=t/2,u="count"in n,p=n.boundingData;for(let t=0;t<6;t++)r[e+t]=p[t];if(u){if(n.buffer){const r=n.buffer;c.set(new Uint8Array(r),t);for(let n=t,c=t+r.byteLength;n<c;n+=o.Ne){const t=n/2;(0,s.K3)(t,a)||(i[n/4+6]+=e)}return t+r.byteLength}{const s=n.offset,r=n.count;return i[e+6]=s,a[l+14]=r,a[l+15]=o.BE,t+o.Ne}}{const s=n.left,r=n.right,a=n.splitAxis;let c;if(c=f(t+o.Ne,s),c/4>d)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[e+6]=c/4,c=f(c,r),i[e+7]=a,c}}},738:(t,n,e)=>{e.d(n,{N:()=>i,g:()=>r});var o=e(25),s=e(734);function r(t,n,e,o,s){let r=1/0,i=1/0,a=1/0,c=-1/0,d=-1/0,l=-1/0,u=1/0,f=1/0,p=1/0,h=-1/0,y=-1/0,P=-1/0;for(let o=6*n,s=6*(n+e);o<s;o+=6){const n=t[o+0],e=t[o+1],s=n-e,m=n+e;s<r&&(r=s),m>c&&(c=m),n<u&&(u=n),n>h&&(h=n);const w=t[o+2],x=t[o+3],T=w-x,g=w+x;T<i&&(i=T),g>d&&(d=g),w<f&&(f=w),w>y&&(y=w);const b=t[o+4],q=t[o+5],A=b-q,B=b+q;A<a&&(a=A),B>l&&(l=B),b<p&&(p=b),b>P&&(P=b)}o[0]=r,o[1]=i,o[2]=a,o[3]=c,o[4]=d,o[5]=l,s[0]=u,s[1]=f,s[2]=p,s[3]=h,s[4]=y,s[5]=P}function i(t,n=null,e=null,r=null){const i=t.attributes.position,a=t.index?t.index.array:null,c=(0,s.Rp)(t),d=i.normalized;let l;null===n?(l=new Float32Array(6*c*4),e=0,r=c):(l=n,e=e||0,r=r||c);const u=i.array,f=i.offset||0;let p=3;i.isInterleavedBufferAttribute&&(p=i.data.stride);const h=["getX","getY","getZ"];for(let t=e;t<e+r;t++){const n=3*t,e=6*t;let s=n+0,r=n+1,c=n+2;a&&(s=a[s],r=a[r],c=a[c]),d||(s=s*p+f,r=r*p+f,c=c*p+f);for(let t=0;t<3;t++){let n,a,f;d?(n=i[h[t]](s),a=i[h[t]](r),f=i[h[t]](c)):(n=u[s+t],a=u[r+t],f=u[c+t]);let p=n;a<p&&(p=a),f<p&&(p=f);let y=n;a>y&&(y=a),f>y&&(y=f);const P=(y-p)/2,m=2*t;l[e+m+0]=p+P,l[e+m+1]=P+(Math.abs(p)+P)*o.bf}}return l}},685:(t,n,e)=>{function o(t,n,e,o,s,r){let i=o,a=o+s-1;const c=r.pos,d=2*r.axis;for(;;){for(;i<=a&&e[6*i+d]<c;)i++;for(;i<=a&&e[6*a+d]>=c;)a--;if(!(i<a))return i;for(let t=0;t<3;t++){let e=n[3*i+t];n[3*i+t]=n[3*a+t],n[3*a+t]=e}for(let t=0;t<6;t++){let n=e[6*i+t];e[6*i+t]=e[6*a+t],e[6*a+t]=n}i++,a--}}e.d(n,{j:()=>o})},916:(t,n,e)=>{function o(t,n,e,o,s,r){let i=o,a=o+s-1;const c=r.pos,d=2*r.axis;for(;;){for(;i<=a&&e[6*i+d]<c;)i++;for(;i<=a&&e[6*a+d]>=c;)a--;if(!(i<a))return i;{let n=t[i];t[i]=t[a],t[a]=n;for(let t=0;t<6;t++){let n=e[6*i+t];e[6*i+t]=e[6*a+t],e[6*a+t]=n}i++,a--}}}e.d(n,{W:()=>o})},918:(t,n,e)=>{e.d(n,{Z:()=>d});var o=e(878),s=e(25);const r=32,i=(t,n)=>t.candidate-n.candidate,a=new Array(r).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),c=new Float32Array(6);function d(t,n,e,d,l,u){let f=-1,p=0;if(u===s.Q7)f=(0,o._V)(n),-1!==f&&(p=(n[f]+n[f+3])/2);else if(u===s.Gm)f=(0,o._V)(t),-1!==f&&(p=function(t,n,e,o){let s=0;for(let r=n,i=n+e;r<i;r++)s+=t[6*r+2*o];return s/e}(e,d,l,f));else if(u===s.Xe){const u=(0,o.S_)(t);let h=s.$J*l;const y=6*d,P=6*(d+l);for(let t=0;t<3;t++){const d=n[t],m=(n[t+3]-d)/r;if(l<r/4){const n=[...a];n.length=l;let r=0;for(let s=y;s<P;s+=6,r++){const i=n[r];i.candidate=e[s+2*t],i.count=0;const{bounds:a,leftCacheBounds:c,rightCacheBounds:d}=i;for(let t=0;t<3;t++)d[t]=1/0,d[t+3]=-1/0,c[t]=1/0,c[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0;(0,o.nd)(s,e,a)}n.sort(i);let c=l;for(let t=0;t<c;t++){const e=n[t];for(;t+1<c&&n[t+1].candidate===e.candidate;)n.splice(t+1,1),c--}for(let s=y;s<P;s+=6){const r=e[s+2*t];for(let t=0;t<c;t++){const i=n[t];r>=i.candidate?(0,o.nd)(s,e,i.rightCacheBounds):((0,o.nd)(s,e,i.leftCacheBounds),i.count++)}}for(let e=0;e<c;e++){const r=n[e],i=r.count,a=l-r.count,c=r.leftCacheBounds,d=r.rightCacheBounds;let y=0;0!==i&&(y=(0,o.S_)(c)/u);let P=0;0!==a&&(P=(0,o.S_)(d)/u);const m=s.nw+s.$J*(y*i+P*a);m<h&&(f=t,h=m,p=r.candidate)}}else{for(let t=0;t<r;t++){const n=a[t];n.count=0,n.candidate=d+m+t*m;const e=n.bounds;for(let t=0;t<3;t++)e[t]=1/0,e[t+3]=-1/0}for(let n=y;n<P;n+=6){let s=~~((e[n+2*t]-d)/m);s>=r&&(s=r-1);const i=a[s];i.count++,(0,o.nd)(n,e,i.bounds)}const n=a[r-1];(0,o.p4)(n.bounds,n.rightCacheBounds);for(let t=r-2;t>=0;t--){const n=a[t],e=a[t+1];(0,o.zH)(n.bounds,e.rightCacheBounds,n.rightCacheBounds)}let i=0;for(let n=0;n<r-1;n++){const e=a[n],r=e.count,d=e.bounds,y=a[n+1].rightCacheBounds;0!==r&&(0===i?(0,o.p4)(d,c):(0,o.zH)(d,c,c)),i+=r;let P=0,m=0;0!==i&&(P=(0,o.S_)(c)/u);const w=l-i;0!==w&&(m=(0,o.S_)(y)/u);const x=s.nw+s.$J*(P*i+m*w);x<h&&(f=t,h=x,p=e.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${u} used.`);return{axis:f,pos:p}}},960:(t,n,e)=>{e.d(n,{s:()=>a});var o=e(437),s=e(667),r=e(355);function i(t){return Math.abs(t)<1e-15}class a extends o.lMl{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new o.Pq0)),this.satBounds=new Array(4).fill().map((()=>new s.f)),this.points=[this.a,this.b,this.c],this.sphere=new o.iyt,this.plane=new o.Zcv,this.needsUpdate=!0}intersectsSphere(t){return(0,r.VW)(t,this)}update(){const t=this.a,n=this.b,e=this.c,o=this.points,s=this.satAxes,r=this.satBounds,i=s[0],a=r[0];this.getNormal(i),a.setFromPoints(i,o);const c=s[1],d=r[1];c.subVectors(t,n),d.setFromPoints(c,o);const l=s[2],u=r[2];l.subVectors(n,e),u.setFromPoints(l,o);const f=s[3],p=r[3];f.subVectors(e,t),p.setFromPoints(f,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(i,t),this.needsUpdate=!1}}a.prototype.closestPointToSegment=function(){const t=new o.Pq0,n=new o.Pq0,e=new o.cZY;return function(o,s=null,i=null){const{start:a,end:c}=o,d=this.points;let l,u=1/0;for(let a=0;a<3;a++){const c=(a+1)%3;e.start.copy(d[a]),e.end.copy(d[c]),(0,r.uf)(e,o,t,n),l=t.distanceToSquared(n),l<u&&(u=l,s&&s.copy(t),i&&i.copy(n))}return this.closestPointToPoint(a,t),l=a.distanceToSquared(t),l<u&&(u=l,s&&s.copy(t),i&&i.copy(a)),this.closestPointToPoint(c,t),l=c.distanceToSquared(t),l<u&&(u=l,s&&s.copy(t),i&&i.copy(c)),Math.sqrt(u)}}(),a.prototype.intersectsTriangle=function(){const t=new a,n=new Array(3),e=new Array(3),r=new s.f,c=new s.f,d=new o.Pq0,l=new o.Pq0,u=new o.Pq0,f=new o.Pq0,p=new o.Pq0,h=new o.cZY,y=new o.cZY,P=new o.cZY,m=new o.Pq0;function w(t,n,e){const o=t.points;let s=0,r=-1;for(let t=0;t<3;t++){const{start:a,end:c}=h;a.copy(o[t]),c.copy(o[(t+1)%3]),h.delta(l);const d=i(n.distanceToPoint(a));if(i(n.normal.dot(l))&&d){e.copy(h),s=2;break}const u=n.intersectLine(h,m);if(!u&&d&&m.copy(a),(u||d)&&!i(m.distanceTo(c))){if(s<=1)(1===s?e.start:e.end).copy(m),d&&(r=s);else if(s>=2){(1===r?e.start:e.end).copy(m),s=2;break}if(s++,2===s&&-1===r)break}}return s}return function(o,s=null,i=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const a=this.plane,l=o.plane;if(Math.abs(a.normal.dot(l.normal))>1-1e-10){const t=this.satBounds,a=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let n=0;n<4;n++){const o=t[n],s=a[n];if(r.setFromPoints(s,e),o.isSeparated(r))return!1}const l=o.satBounds,u=o.satAxes;n[0]=this.a,n[1]=this.b,n[2]=this.c;for(let t=0;t<4;t++){const e=l[t],o=u[t];if(r.setFromPoints(o,n),e.isSeparated(r))return!1}for(let t=0;t<4;t++){const o=a[t];for(let t=0;t<4;t++){const s=u[t];if(d.crossVectors(o,s),r.setFromPoints(d,n),c.setFromPoints(d,e),r.isSeparated(c))return!1}}return s&&(i||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),s.start.set(0,0,0),s.end.set(0,0,0)),!0}{const t=w(this,l,y);if(1===t&&o.containsPoint(y.end))return s&&(s.start.copy(y.end),s.end.copy(y.end)),!0;if(2!==t)return!1;const n=w(o,a,P);if(1===n&&this.containsPoint(P.end))return s&&(s.start.copy(P.end),s.end.copy(P.end)),!0;if(2!==n)return!1;if(y.delta(u),P.delta(f),u.dot(f)<0){let t=P.start;P.start=P.end,P.end=t}const e=y.start.dot(u),r=y.end.dot(u),i=P.start.dot(u),c=P.end.dot(u);return(e===c||i===r||r<i!=e<c)&&(s&&(p.subVectors(y.start,P.start),p.dot(u)>0?s.start.copy(y.start):s.start.copy(P.start),p.subVectors(y.end,P.end),p.dot(u)<0?s.end.copy(y.end):s.end.copy(P.end)),!0)}}}(),a.prototype.distanceToPoint=function(){const t=new o.Pq0;return function(n){return this.closestPointToPoint(n,t),n.distanceTo(t)}}(),a.prototype.distanceToTriangle=function(){const t=new o.Pq0,n=new o.Pq0,e=["a","b","c"],s=new o.cZY,i=new o.cZY;return function(o,a=null,c=null){const d=a||c?s:null;if(this.intersectsTriangle(o,d))return(a||c)&&(a&&d.getCenter(a),c&&d.getCenter(c)),0;let l=1/0;for(let n=0;n<3;n++){let s;const r=e[n],i=o[r];this.closestPointToPoint(i,t),s=i.distanceToSquared(t),s<l&&(l=s,a&&a.copy(t),c&&c.copy(i));const d=this[r];o.closestPointToPoint(d,t),s=d.distanceToSquared(t),s<l&&(l=s,a&&a.copy(d),c&&c.copy(t))}for(let d=0;d<3;d++){const u=e[d],f=e[(d+1)%3];s.set(this[u],this[f]);for(let d=0;d<3;d++){const u=e[d],f=e[(d+1)%3];i.set(o[u],o[f]),(0,r.uf)(s,i,t,n);const p=t.distanceToSquared(n);p<l&&(l=p,a&&a.copy(t),c&&c.copy(n))}}return Math.sqrt(l)}}()},355:(t,n,e)=>{e.d(n,{VW:()=>i,uf:()=>r});var o=e(437);const s=function(){const t=new o.Pq0,n=new o.Pq0,e=new o.Pq0;return function(o,s,r){const i=o.start,a=t,c=s.start,d=n;e.subVectors(i,c),t.subVectors(o.end,o.start),n.subVectors(s.end,s.start);const l=e.dot(d),u=d.dot(a),f=d.dot(d),p=e.dot(a),h=a.dot(a)*f-u*u;let y,P;y=0!==h?(l*u-p*f)/h:0,P=(l+y*u)/f,r.x=y,r.y=P}}(),r=function(){const t=new o.I9Y,n=new o.Pq0,e=new o.Pq0;return function(o,r,i,a){s(o,r,t);let c=t.x,d=t.y;if(c>=0&&c<=1&&d>=0&&d<=1)return o.at(c,i),void r.at(d,a);if(c>=0&&c<=1)return d<0?r.at(0,a):r.at(1,a),void o.closestPointToPoint(a,!0,i);if(d>=0&&d<=1)return c<0?o.at(0,i):o.at(1,i),void r.closestPointToPoint(i,!0,a);{let t,s;t=c<0?o.start:o.end,s=d<0?r.start:r.end;const l=n,u=e;return o.closestPointToPoint(s,!0,n),r.closestPointToPoint(t,!0,e),l.distanceToSquared(s)<=u.distanceToSquared(t)?(i.copy(l),void a.copy(s)):(i.copy(t),void a.copy(u))}}}(),i=function(){const t=new o.Pq0,n=new o.Pq0,e=new o.Zcv,s=new o.cZY;return function(o,r){const{radius:i,center:a}=o,{a:c,b:d,c:l}=r;if(s.start=c,s.end=d,s.closestPointToPoint(a,!0,t).distanceTo(a)<=i)return!0;if(s.start=c,s.end=l,s.closestPointToPoint(a,!0,t).distanceTo(a)<=i)return!0;if(s.start=d,s.end=l,s.closestPointToPoint(a,!0,t).distanceTo(a)<=i)return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=i){const t=u.projectPoint(a,n);if(r.containsPoint(t))return!0}return!1}}()},832:(t,n,e)=>{e.d(n,{S:()=>a});var o=e(437),s=e(667),r=e(960),i=e(355);class a{constructor(t,n,e){this.isOrientedBox=!0,this.min=new o.Pq0,this.max=new o.Pq0,this.matrix=new o.kn4,this.invMatrix=new o.kn4,this.points=new Array(8).fill().map((()=>new o.Pq0)),this.satAxes=new Array(3).fill().map((()=>new o.Pq0)),this.satBounds=new Array(3).fill().map((()=>new s.f)),this.alignedSatBounds=new Array(3).fill().map((()=>new s.f)),this.needsUpdate=!1,t&&this.min.copy(t),n&&this.max.copy(n),e&&this.matrix.copy(e)}set(t,n,e){this.min.copy(t),this.max.copy(n),this.matrix.copy(e),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}a.prototype.update=function(){const t=this.matrix,n=this.min,e=this.max,o=this.points;for(let s=0;s<=1;s++)for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){const a=o[1*s|2*r|4*i];a.x=s?e.x:n.x,a.y=r?e.y:n.y,a.z=i?e.z:n.z,a.applyMatrix4(t)}const s=this.satBounds,r=this.satAxes,i=o[0];for(let t=0;t<3;t++){const n=r[t],e=s[t],a=o[1<<t];n.subVectors(i,a),e.setFromPoints(n,o)}const a=this.alignedSatBounds;a[0].setFromPointsField(o,"x"),a[1].setFromPointsField(o,"y"),a[2].setFromPointsField(o,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},a.prototype.intersectsBox=function(){const t=new s.f;return function(n){this.needsUpdate&&this.update();const e=n.min,o=n.max,s=this.satBounds,r=this.satAxes,i=this.alignedSatBounds;if(t.min=e.x,t.max=o.x,i[0].isSeparated(t))return!1;if(t.min=e.y,t.max=o.y,i[1].isSeparated(t))return!1;if(t.min=e.z,t.max=o.z,i[2].isSeparated(t))return!1;for(let e=0;e<3;e++){const o=r[e],i=s[e];if(t.setFromBox(o,n),i.isSeparated(t))return!1}return!0}}(),a.prototype.intersectsTriangle=function(){const t=new r.s,n=new Array(3),e=new s.f,i=new s.f,a=new o.Pq0;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const s=this.satBounds,r=this.satAxes;n[0]=o.a,n[1]=o.b,n[2]=o.c;for(let t=0;t<3;t++){const o=s[t],i=r[t];if(e.setFromPoints(i,n),o.isSeparated(e))return!1}const c=o.satBounds,d=o.satAxes,l=this.points;for(let t=0;t<3;t++){const n=c[t],o=d[t];if(e.setFromPoints(o,l),n.isSeparated(e))return!1}for(let t=0;t<3;t++){const o=r[t];for(let t=0;t<4;t++){const s=d[t];if(a.crossVectors(o,s),e.setFromPoints(a,n),i.setFromPoints(a,l),e.isSeparated(i))return!1}}return!0}}(),a.prototype.closestPointToPoint=function(t,n){return this.needsUpdate&&this.update(),n.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),n},a.prototype.distanceToPoint=function(){const t=new o.Pq0;return function(n){return this.closestPointToPoint(n,t),n.distanceTo(t)}}(),a.prototype.distanceToBox=function(){const t=["x","y","z"],n=new Array(12).fill().map((()=>new o.cZY)),e=new Array(12).fill().map((()=>new o.cZY)),s=new o.Pq0,r=new o.Pq0;return function(o,a=0,c=null,d=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||d)&&(o.getCenter(r),this.closestPointToPoint(r,s),o.closestPointToPoint(s,r),c&&c.copy(s),d&&d.copy(r)),0;const l=a*a,u=o.min,f=o.max,p=this.points;let h=1/0;for(let t=0;t<8;t++){const n=p[t];r.copy(n).clamp(u,f);const e=n.distanceToSquared(r);if(e<h&&(h=e,c&&c.copy(n),d&&d.copy(r),e<l))return Math.sqrt(e)}let y=0;for(let o=0;o<3;o++)for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){const i=(o+1)%3,a=(o+2)%3,c=1<<o|s<<i|r<<a,d=p[s<<i|r<<a],l=p[c];n[y].set(d,l);const h=t[o],P=t[i],m=t[a],w=e[y],x=w.start,T=w.end;x[h]=u[h],x[P]=s?u[P]:f[P],x[m]=r?u[m]:f[P],T[h]=f[h],T[P]=s?u[P]:f[P],T[m]=r?u[m]:f[P],y++}for(let t=0;t<=1;t++)for(let n=0;n<=1;n++)for(let e=0;e<=1;e++){r.x=t?f.x:u.x,r.y=n?f.y:u.y,r.z=e?f.z:u.z,this.closestPointToPoint(r,s);const o=r.distanceToSquared(s);if(o<h&&(h=o,c&&c.copy(s),d&&d.copy(r),o<l))return Math.sqrt(o)}for(let t=0;t<12;t++){const o=n[t];for(let t=0;t<12;t++){const n=e[t];(0,i.uf)(o,n,s,r);const a=s.distanceToSquared(r);if(a<h&&(h=a,c&&c.copy(s),d&&d.copy(r),a<l))return Math.sqrt(a)}}return Math.sqrt(h)}}()},667:(t,n,e)=>{e.d(n,{f:()=>s});var o=e(437);class s{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,n){let e=1/0,o=-1/0;for(let s=0,r=t.length;s<r;s++){const r=t[s][n];e=r<e?r:e,o=r>o?r:o}this.min=e,this.max=o}setFromPoints(t,n){let e=1/0,o=-1/0;for(let s=0,r=n.length;s<r;s++){const r=n[s],i=t.dot(r);e=i<e?i:e,o=i>o?i:o}this.min=e,this.max=o}isSeparated(t){return this.min>t.max||t.min>this.max}}s.prototype.setFromBox=function(){const t=new o.Pq0;return function(n,e){const o=e.min,s=e.max;let r=1/0,i=-1/0;for(let e=0;e<=1;e++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){t.x=o.x*e+s.x*(1-e),t.y=o.y*a+s.y*(1-a),t.z=o.z*c+s.z*(1-c);const d=n.dot(t);r=Math.min(d,r),i=Math.max(d,i)}this.min=r,this.max=i}}(),new s}}]);